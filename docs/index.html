<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="Permissions-Policy" content="interest-cohort=()"/><link rel="icon" href="/cli/favicon.ico"/><title>@magic/cli</title><meta name="description" content="declarative cli wrapper for @magic"/><script type="application/ld+json">{"@context":"http://schema.org","@type":"website","name":"@magic/cli"}</script><link rel="stylesheet" href="/cli/magic.css?S6KqwlVvY/" integrity="sha384-S6KqwlVvY/KJ8U/Hv0xDEJN7IFjxy4KYbn0Z4lYLGl3T9il5udDt9owgAgDlGkLb" crossorigin="anonymous"/></head><body><a class="SkipLink" href="/cli/#page">Skip to Content</a><main id="Magic"><div class="Wrapper"><header class="Header"><a class="Logo" href="/cli/"><svg viewBox="0 0 512 444"><path d="M512 444L256 0 0 444z" fill="#663695"></path><circle cx="256" cy="294" r="130" fill="#fff"></circle><circle cx="256" cy="281" r="40" fill="#663695"></circle><path d="M256 350v44m24-44l1 13c1 27 29 27 29-7m-160-72s46-47 106-47c59 0 106 47 106 47s-47 43-106 43c-60 0-106-43-106-43zm65-75a134 134 0 0189 2" class="stroke"></path><path d="M256 81v53m184 270l-43-29M72 404l43-29" class="stroke white"></path></svg></a><p>@magic/cli</p><nav class="Menu"><ul><li><a href="/cli/#install">install</a></li><li><a href="/cli/#caveats">caveats</a></li><li><a href="/cli/#usage">usage</a></li><li><a href="/cli/#argv">argv</a></li><li><a href="/cli/#commands">commands</a></li><li><a href="/cli/#help">help</a></li><li><a href="/cli/#config">configuration</a></li><li><a href="/cli/#clean">clean</a></li><li><a href="/cli/#required">required</a></li><li><a href="/cli/#source">source</a></li></ul></nav></header><div class="Page" id="page"><h1 id="magiccli">@magic/cli</h1><p>declarative cli sanitization and execution for <a href="https://magic.github.io" target="_blank" rel="noopener">@magic</a></p><p>sanitizes cli flags from aliases to default names
rewrites process.argv accordingly
provides autogenerated --help output (that can be customized)
also handles commands and environment for you</p><p>exports a commonjs file that allows to launch mjs files as clis</p><ul class="GitBadges"><li><a href="https://www.npmjs.com/package/@magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/@magic/cli?color=blue" height="23" role="presentation" alt="" loading="lazy"/></a></li><li><img src="https://img.shields.io/node/v/@magic/cli?color=blue" height="23" role="presentation" alt="" loading="lazy"/></li><li><img src="https://img.shields.io/npm/l/@magic/cli?color=blue" height="23" role="presentation" alt="" loading="lazy"/></li><li><a href="https://travis-ci.com/magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/travis/com/magic/cli/master" height="23" role="presentation" alt="" loading="lazy"/></a></li><li><a href="https://ci.appveyor.com/project/magic/cli/branch/master" target="_blank" rel="noopener"><img src="https://img.shields.io/appveyor/ci/magic/cli/master.svg" height="23" role="presentation" alt="" loading="lazy"/></a></li><li><a href="https://coveralls.io/github/magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/coveralls/github/magic/cli/master.svg" height="23" role="presentation" alt="" loading="lazy"/></a></li><li><a href="https://snyk.io/test/github/magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/snyk/vulnerabilities/github/magic/cli.svg" height="23" role="presentation" alt="" loading="lazy"/></a></li></ul><h3 id="install">install</h3><p>be in a nodejs project</p><div class="Pre"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">npm</span> i --save-dev @magic/cli</code></pre></div><h3 id="caveats">caveats</h3><p>there are some quirks that need some careful consideration when designing a cli api.</p><p>depending on your requirements, these caveats may or may not apply.</p><ul><li><h4 id="last-argument">last argument</h4><p>if your last argument does not have a corresponding flag,
it will still be assigned to the last flag prior to it.</p><h5 id="workaround">workaround</h5><p>do not design a cli with a trailing command.
TODO: add a config bool.</p></li><li><h4 id="option-argument-and-command-name-clash">option argument and command name clash</h4><p>if one of your options gets an argument that is equal to a command,
this command will be executed</p><h5 id="workaround-1">workaround</h5><p>do not name your commands like the possible arguments.</p></li><li><h4 id="flag-arguments-can-not-start-with-a-dash">flag arguments can not start with a dash</h4><p>cli arguments that start with a - will always be treated as flags, not values.</p><h5 id="workaround-2">workaround</h5><p>do not design a cli that accepts arguments that start with a -</p></li></ul><p>those issues might get addressed in the future.</p><h3 id="usage">Usage</h3><p>full api example</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">#!/usr/bin/env node</code><code class="line"></code><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/index.mjs&#39;</span>&#39;</code><code class="line"></code><code class="line"><span class="keyword">const</span> { argv, env, commands } = cli({</code><code class="line">  commands: [</code><code class="line">    [<span class="string">&#39;cmd1&#39;</span>, <span class="string">&#39;cmd1alias&#39;</span>],</code><code class="line">    <span class="string">&#39;cmd2&#39;</span>,</code><code class="line">  ],</code><code class="line">  options: [</code><code class="line">    [<span class="string">&#39;--flag1&#39;</span>, <span class="string">&#39;-f1&#39;</span>],</code><code class="line">    [<span class="string">&#39;--flag2&#39;</span>, <span class="string">&#39;-f2&#39;</span>],</code><code class="line">  ],</code><code class="line">  default: {</code><code class="line">    <span class="string">&#39;--default-key&#39;</span>: <span class="string">&#39;default-value&#39;</span>,</code><code class="line">  },</code><code class="line">  single: [</code><code class="line">    <span class="string">&#39;--default-key&#39;</span>,</code><code class="line">  ],</code><code class="line">  required: [</code><code class="line">    <span class="string">&#39;--default-key&#39;</span>,</code><code class="line">  ],</code><code class="line">  pure: true, <span class="comment">// <span class="keyword">do</span> neither change process.argv nor process.env</span></code><code class="line">  pureArgv: true, <span class="comment">// <span class="keyword">do</span> not change process.argv</span></code><code class="line">  pureEnv: true, <span class="comment">// <span class="keyword">do</span> not change process.env</span></code><code class="line">})</code></pre></div><h3 id="argv">options / argv</h3><p>argv mappings will handle options and option aliases</p><p>using the <a href="/cli/#usage">cli file</a> above</p><p>then, in your terminal / bash
<div class="Pre"><div class="menu"><button>copy</button></div><pre><code class="line">bin.mjs -f1 arg1 arg2 -f2</code></pre></div></p><p>resulting process.argv</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">process.argv = [</code><code class="line">  <span class="string">&#39;/path/to/bin/node&#39;</span>,</code><code class="line">  <span class="string">&#39;/path/to/bin.mjs&#39;</span>,</code><code class="line">  <span class="string">&#39;--flag1&#39;</span></code><code class="line">  <span class="string">&#39;arg1&#39;</span>,</code><code class="line">  <span class="string">&#39;arg2&#39;</span>,</code><code class="line">  <span class="string">&#39;--flag2&#39;</span>,</code><code class="line">]</code></pre></div><p>returned javascript object
<div class="Pre"><div class="menu"><button>copy</button></div><pre><code class="line">argv === { <span class="string">&#39;--flag1&#39;</span>: [<span class="string">&#39;arg1&#39;</span>, arg2], <span class="string">&#39;--flag2&#39;</span>: []}</code></pre></div></p><h3 id="commands">commands</h3><p>cli commands can be handled too.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/index.mjs&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  commands: [</code><code class="line">    [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>, <span class="string">&#39;start&#39;</span>],</code><code class="line">    <span class="string">&#39;serve&#39;</span>,</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// call</span></code><code class="line">./bin.mjs dev serve</code><code class="line"></code><code class="line"><span class="comment">// results:</span></code><code class="line">{</code><code class="line">  cmds: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;serve&#39;</span>],</code><code class="line">  commands: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;serve&#39;</span>],</code><code class="line">}</code></pre></div><h3 id="help">help output</h3><p>@magic/cli will derive a help text from your configuration.</p><p>help itself can be configured to provide better error messages.</p><h4 id="help-simple">simple help message</h4><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/index.mjs&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  commands: [[<span class="string">&#39;magic&#39;</span>, <span class="string">&#39;m&#39;</span>]],</code><code class="line">  options: [[<span class="string">&#39;--spell&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  prepend: <span class="string">&#39;prepend&#39;</span>,</code><code class="line">  append: <span class="string">&#39;append&#39;</span>,</code><code class="line">  help: <span class="string">&#39;custom help text&#39;</span>,</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// running</span></code><code class="line">./bin.mjs</code><code class="line"><span class="comment">// without arguments</span></code><code class="line"></code><code class="line"><span class="comment">// help output</span></code><code class="line"></code><code class="line">@magic/cli wrapped cli.</code><code class="line"></code><code class="line">custom help text</code><code class="line"></code><code class="line">cli commands</code><code class="line">magic - aliases: [<span class="string">&quot;m&quot;</span>]</code><code class="line"></code><code class="line"></code><code class="line">possible command line flags:</code><code class="line">--spell - aliases: [<span class="string">&quot;-s&quot;</span>]</code><code class="line"></code><code class="line"></code><code class="line">environment switches:</code><code class="line">dev: set NODE_ENV to development - aliases [<span class="string">&quot;development&quot;</span>]</code></pre></div><h4 id="help-detailed">detailed help message</h4><p>the help property will accept an object which maps to the args object.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/index.mjs&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  commands: [[<span class="string">&#39;magic&#39;</span>, <span class="string">&#39;m&#39;</span>]],</code><code class="line">  options: [[<span class="string">&#39;--spell&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  prepend: <span class="string">&#39;prepend&#39;</span>,</code><code class="line">  append: <span class="string">&#39;append&#39;</span>,</code><code class="line">  help: {</code><code class="line">    name: <span class="string">&#39;cli name&#39;</span>,</code><code class="line">    text: <span class="string">&#39;custom help text&#39;</span>,</code><code class="line">    commands: {</code><code class="line">      magic: <span class="string">&#39;magic info help text&#39;</span>,</code><code class="line">    },</code><code class="line">    options: {</code><code class="line">      <span class="string">&#39;--spell&#39;</span>: <span class="string">&#39;cast a simple spell&#39;</span>,</code><code class="line">    },</code><code class="line">    env: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;set environment to development&#39;</span>],</code><code class="line">  },</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// running</span></code><code class="line">./bin.mjs</code><code class="line"><span class="comment">// without arguments</span></code><code class="line"></code><code class="line"><span class="comment">// help output</span></code><code class="line"></code><code class="line">cli name</code><code class="line"></code><code class="line">custom help text</code><code class="line"></code><code class="line">commands:</code><code class="line">magic - aliases: [<span class="string">&quot;m&quot;</span>]</code><code class="line"></code><code class="line">flags:</code><code class="line">--spell - aliases: [<span class="string">&quot;-s&quot;</span>]</code><code class="line"></code><code class="line">environment switches:</code><code class="line">dev: set process.NODE_ENV to development - aliases [<span class="string">&quot;development&quot;</span>]</code></pre></div><h4 id="clean">clean</h4><p>some cli arguments will be expected to return a string instead of a list of arguments.</p><p>this can be achieved using the single array</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  options: [[<span class="string">&#39;--single&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  single: [<span class="string">&#39;--single&#39;</span>],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> res = cli(args)</code><code class="line"></code><code class="line">console.log(res)</code></pre></div><h4 id="required">required</h4><p>some cli arguments will be required.</p><p>this can be achieved using the required array.</p><p>if a required field is missing, a error message and the help will be shown.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  options: [[<span class="string">&#39;--required&#39;</span>, <span class="string">&#39;-r&#39;</span>]],</code><code class="line">  required: [<span class="string">&#39;--required&#39;</span>],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> res = cli(args)</code><code class="line"></code><code class="line">console.log(res)</code></pre></div><h3 id="config">config</h3><p>there are some configuration parameters that can be passed to the cli function</p><h4 id="config-pure">pure</h4><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  pure: false,    <span class="comment">// set to <span class="boolean">true</span> to prevent changes to process.argv and process.env</span></code><code class="line">  pureEnv: false, <span class="comment">// set to <span class="boolean">true</span> to prevent changes to process.env</span></code><code class="line">  pureArgv: false, <span class="comment">// set to <span class="boolean">true</span> to prevent changes to process.argv</span></code><code class="line">}</code><code class="line"></code><code class="line">cli(args)</code></pre></div><h3 id="config-prependappend">prepend/append</h3><p>process.argv values can be prepended and appended</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/index.mjs&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  prepend: [<span class="string">&#39;prepended&#39;</span>]</code><code class="line">  append: [<span class="string">&#39;appended&#39;</span>]</code><code class="line">}</code><code class="line"></code><code class="line">cli(args)</code></pre></div><h4 id="config-default">default</h4><p>use this to set default process.argv key: value pairs that should be set if they are not</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/index.mjs&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  options: [</code><code class="line">    [<span class="string">&#39;--default-key&#39;</span>],</code><code class="line">  ],</code><code class="line">  default: {</code><code class="line">    <span class="string">&#39;--default-key&#39;</span>: <span class="string">&#39;default-value&#39;</span>,</code><code class="line">  },</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// returns</span></code><code class="line">{</code><code class="line">  argv: {</code><code class="line">    <span class="string">&#39;--default-key&#39;</span>: <span class="string">&#39;default-value&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div><h2 id="source">source</h2><p>the source for this page is in the
<a href="https://github.com/magic/cli/tree/master/docsrc" target="_blank" rel="noopener">docsrc directory</a>
and gets built and published to github using <a href="https://github.com/magic/core" target="_blank" rel="noopener">@magic/core</a></p></div><footer class="Footer"><div class="Container"><div class="Credits">made with a few bits of <a target="_blank" rel="noopener" href="https://magic.github.io/">magic</a></div></div></footer></div></main><script src="/cli/magic.js?JPv/uNIGg9" integrity="sha384-JPv/uNIGg96VFyXzF5dL4+wGHo3ICznVXauXvNJXuZ0lrT/7CudrFW6R8eCyfRFM" crossorigin="anonymous"></script></body></html>